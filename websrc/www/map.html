<!DOCTYPE html>
<html LANG="ko">
<div id="mapview_page" data-sn='' data-sigcd='' style='position:absolute; min-height: 100%;' data-role="page" data-theme="none" data-dom-cache="true">
    <div id="map" data-role="content" data-theme="none" style="height: 100%;"></div>
    <form class="ui-filterable">

        <input id="autocomplete-input" data-type="search" placeholder="도로명 주소(or 기초번호) 검색(3글자 이상)">

    </form>
    <ul id="autocomplete" data-role="listview" data-inset="true" data-filter="true" data-input="#autocomplete-input"></ul>
    <div id="panel-wrap">
        <div data-role="popup" id="popup-content" class="popup-content">
            <h4 class="ui-bar">도로명판</h4>
            <div class="ui-body">
                <div class="img-placeholder">
                    <img src="img/main/roadname_bg.png" style="width: 55%; margin-top: 4%; text-align: center;" />
                </div>
                <div class="memo">
                    <textarea placeholder="기타사항을 입력하세요."></textarea>
                </div>
                <div class="detail">
                    <form>
                        <div class="ui-field-contain">
                            <label for="instSpotCd">설치지점</label>
                            <select name="instSpotCd" id="instSpotCd">
                                <option value="">설치</option>
                            </select>
                        </div>
                        <div class="ui-field-contain">
                            <label for="isLgnYn">설치재설치 여부</label>
                            <select name="isLgnYn" id="isLgnYn">
                            </select>
                        </div>
                        <div class="ui-field-contain">
                            <label for="instSpotDesc">설치지점명</label>
                            <input type="text" name="instSpotDesc" id="instSpotDesc" value="" />
                        </div>
                        <div class="ui-field-contain">
                            <label for="frontKoreanRoadNm">한글도로명</label>
                            <input type="text" name="frontKoreanRoadNm" id="frontKoreanRoadNm" value="" />
                        </div>
                        <div class="ui-field-contain">
                            <label for="frontRomeRoadNm">로마자 도로명</label>
                            <input type="text" name="frontRomeRoadNm" id="frontRomeRoadNm" value="" />
                        </div>
                        <div class="ui-field-contain">
                            <label for="gdftyForm">안내시설형식</label>
                            <select name="gdftyForm" id="gdftyForm">
                            </select>
                        </div>
                        <div class="ui-field-contain">
                            <label for="plqDirection">안내시설방향</label>
                            <select name="plqDirection" id="plqDirection">
                            </select>
                        </div>
                    </form>
                </div>
            </div>
            <div class="ui-body popup-btn">
                <a href="javascript:util.gotoTask('mapservice')" data-role="button" data-shadow="false" data-theme="none">
                    <img src="img/icon/btn_normalcy_on.png" />
                </a>
                <a href="javascript:util.gotoTask('mapservice')" data-role="button" data-shadow="false" data-theme="none">
                    <img src="img/icon/btn_damage_off.png" />
                </a>
                <a href="javascript:util.gotoTask('mapservice')" data-role="button" data-shadow="false" data-theme="none">
                    <img src="img/icon/btn_loss_off.png" />
                </a>
                <a href="javascript:util.gotoTask('mapservice')" data-role="button" data-shadow="false" data-theme="none">
                    <!--<img src="img/icon/btn_loss_off.png" />-->
                    적용
                </a>
            </div>
        </div>
    </div>
    <div id="map_current"><img src="../images/ico_map_current.png" width="40px" /></div>
    <div id="write_memo"><img src="../images/ico_map_current.png" width="40px" /></div>
    <div id="viewportline"><img src="../images/ico_map_current.png" width="40px" /></div>
    <div id="map_cordova"><img src="../images/ico_map_current.png" width="40px" /></div>
    <div class='memo-container'>
        <label>제목</label>
        <textarea id='mapview_memo' data-role='none' rows='5' placeholder='기타사항을 입력하세요'></textarea>
        <div>
            <button data-role='none' onclick='memoFlush()'>취 소</button>
            <button data-role='none' onclick='memoAccept()'>입 력</button>
        </div>
    </div>
    <div id="map_keypad_opt" class='keypad_menubar display-none'>
        <div>
            입력 완료
        </div>
    </div>
    <div id="info"></div>
    <div id="info2"></div>
    <div id="marker">
        <img src="../images/marker-icon.png">
    </div>

    <script type="text/javascript">
        $(document).on("pagecreate", pages.map.div, function() {
        });

        $(document).on("pagehide", pages.map.div, function(event, data) {

        });

        $(document).on("pagebeforeshow", pages.map.div, function(event, data) {
        });

        $(document).on("pageshow", pages.map.div, function() {
            var context = app.context;

            if (util.isEmpty(context))
                return;

            // 현재 위치 불러오기
            datasource.getGeolocation().then(function(geoPos) {
                var pos = (geoPos.TYPE == "GPS" ?
                ol.proj.fromLonLat([geoPos.LOCATION_X, geoPos.LOCATION_Y], baseProjection.getCode())
                : [geoPos.LOCATION_X, geoPos.LOCATION_Y]);

                //성암로 189(사업장)
                //        pos = [946842.8750, 1953211.2031]; //EPSG:5179
                //상당로 155(청주시청)
                pos = [999069.3800380124,1849434.7981913204];  //EPSG:5179
                //중앙로 40(김제시청)
                //        pos = [944131.2044213761, 1756634.1104898946];  //EPSG:5179


                mapInit(pos);
            });
            app.context = {};
        });

        $(document).on("focus", "#mapview_memo", function() {
            $('#map_keypad_opt').removeClass('display-none');
        });

        $(document).on("focusout", "#mapview_memo", function() {
            $('#map_keypad_opt').addClass('display-none');
        });

        $("#write_memo").on("click", function() {
            showMemoInput({});
        });

        $("#viewportline").on("click", function() {
            $('.centerline').toggleClass('displaynone');
        });

        function showMemoInput(jsonData) {
            var memocontainer = $('#mapview_page > .memo-container');
            var top = ($('.titleheader').outerHeight() + 10) + 'px';
            memocontainer.css('top', top);
        }

        function hideMemoInput() {
            var memocontainer = $('#mapview_page > .memo-container');
            var top = '-12em';
            memocontainer.css('top', top);
        }

        function memoAccept() {
            var memo = {
                date: util.getToday(true),
                memo: $('#mapview_memo').val(),
                x: 0,
                y: 1,
                jsons: {}
            }
            datasource.addMemo(memo);

            memoFlush();
        }

        function memoFlush() {
            $('#mapview_memo').val('');
            hideMemoInput();

            datasource.memoList({}, function(dataArray) {
                console.log(dataArray);
                for (data in dataArray) {
                    console.log(data);
                }
            });
        }

        function viewportline() {

            var canvas = document.getElementById('centerlineCv');

            if (canvas.getContext) {
                var ctx = canvas.getContext('2d');

                var deviceRatio = window.devicePixelRatio;
                var backingStoreRatio = ctx.webkitBackingStorePixelRatio ||
                    ctx.mozBackingStorePixelRatio ||
                    ctx.msBackingStorePixelRatio ||
                    ctx.oBackingStorePixelRatio ||
                    ctx.backingStorePixelRatio || 1;
                var ratio = deviceRatio / backingStoreRatio;

                canvas.width = $('#centerlineCv').width() * ratio;
                canvas.height = $('#centerlineCv').height() * ratio;
                ctx.scale(ratio, ratio);

                var x = canvas.clientWidth / 2;
                var y = canvas.clientHeight / 2;
                ctx.clearRect(0, 0, x, y);
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, 2 * y);
                ctx.moveTo(0, y);
                ctx.lineTo(2 * x, y);
                ctx.strokeStyle = '#888888';
                ctx.stroke();
            }
        }
    </script>
</div>
